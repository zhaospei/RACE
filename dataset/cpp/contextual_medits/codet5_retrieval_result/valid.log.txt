10/04/2023 08:39:01 - INFO - __main__ -   Namespace(ECMG_type='shared_encoders', adam_epsilon=1e-08, add_lang_ids=False, add_task_prefix=False, always_save_model=False, base_model_type='codet5', beam_size=10, cache_path='cache/codesum/java', config_name='', data_num=-1, debug=False, dev_filename='../data/commit_msg/java/contextual_medits/valid.jsonl', dev_retireved_filename='../data/commit_msg/java/contextual_medits/valid.jsonl', diff_type='contextual-medit', do_eval=False, do_eval_bleu=False, do_lower_case=False, do_retrieval=True, do_test=False, do_train=False, eval_batch_size=6, eval_frequency=1, eval_steps=-1, eval_task='', gradient_accumulation_steps=1, is_cosine_space=True, lang='java', learning_rate=5e-05, load_finetuned_model_path=None, load_model_path='saved_model/codet5/cpp/checkpoint-best-bleu/pytorch_model.bin', local_rank=-1, log_steps=-1, max_grad_norm=1.0, max_source_length=200, max_steps=-1, max_target_length=30, model_name_or_path='Salesforce/codet5-base', model_type='codet5', n_debug_samples=100, no_cuda=False, num_train_epochs=10, output_dir='../saved_model/commit_msg_generation/java/tmp', patience=5, retrieval_filename='dataset/cpp/contextual_medits/valid.jsonl', retrieval_result_dir='dataset/cpp/contextual_medits/codet5_retrieval_result', retrieval_result_filename='valid.jsonl', run_codet5=True, save_last_checkpoints=False, save_steps=-1, seed=3407, start_epoch=0, summary_dir='saved_model/codesum/tmp', task='summarize', test_filename='../data/commit_msg/java/contextual_medits/test.jsonl', test_retireved_filename='../data/commit_msg/java/contextual_medits/test.jsonl', tokenizer_name='Salesforce/codet5-small', train_batch_size=6, train_filename='dataset/cpp/contextual_medits/train.jsonl', train_retireved_filename='../data/commit_msg/java/contextual_medits/train.jsonl', train_steps=-1, warmup_steps=100, weight_decay=0.0)
10/04/2023 08:39:01 - WARNING - __main__ -   Process rank: -1, device: cuda, n_gpu: 1, distributed training: False, cpu count: 8
10/04/2023 08:39:09 - INFO - __main__ -   adding new token {'additional_special_tokens': ['<REPLACE>', '<REPLACE_OLD>', '<REPLACE_NEW>', '<REPLACE_END>', '<INSERT>', '<INSERT_OLD>', '<INSERT_NEW>', '<INSERT_END>', '<DELETE>', '<DELETE_END>', '<KEEP>', '<KEEP_END>']}
10/04/2023 08:39:09 - INFO - __main__ -   Reload model from saved_model/codet5/cpp/checkpoint-best-bleu/pytorch_model.bin
10/04/2023 08:39:17 - INFO - __main__ -     ***** retrievaling *****
10/04/2023 08:39:17 - INFO - __main__ -     Batch size = 6
10/04/2023 08:40:10 - INFO - util -   Read 23172 examples, avg src len: 210, avg trg len: 7, max src len: 3907, max trg len: 15
10/04/2023 08:40:10 - INFO - util -   [TOKENIZE] avg src len: 237, avg trg len: 14, max src len: 4465, max trg len: 71
10/04/2023 08:40:10 - INFO - util -   Create cache data into cache/codesum/java/train_all.pt
  0%|          | 0/23172 [00:00<?, ?it/s]  3%|▎         | 725/23172 [00:00<00:04, 4928.70it/s]  6%|▋         | 1450/23172 [00:00<00:03, 5859.38it/s]  9%|▉         | 2175/23172 [00:00<00:03, 6153.01it/s] 13%|█▎        | 2900/23172 [00:00<00:03, 6301.02it/s] 16%|█▌        | 3625/23172 [00:00<00:03, 6390.86it/s] 19%|█▉        | 4350/23172 [00:00<00:02, 6442.58it/s] 22%|██▏       | 5075/23172 [00:00<00:02, 6479.37it/s] 28%|██▊       | 6525/23172 [00:02<00:09, 1666.98it/s] 31%|███▏      | 7250/23172 [00:02<00:09, 1653.63it/s] 34%|███▍      | 7975/23172 [00:02<00:07, 2062.67it/s] 38%|███▊      | 8700/23172 [00:03<00:05, 2490.01it/s] 44%|████▍     | 10150/23172 [00:03<00:03, 3406.38it/s] 47%|████▋     | 10875/23172 [00:03<00:03, 3767.96it/s] 53%|█████▎    | 12325/23172 [00:04<00:05, 2068.82it/s] 56%|█████▋    | 13050/23172 [00:04<00:05, 2016.90it/s] 59%|█████▉    | 13775/23172 [00:05<00:04, 2294.15it/s] 63%|██████▎   | 14500/23172 [00:05<00:03, 2621.83it/s] 69%|██████▉   | 15950/23172 [00:05<00:02, 3487.44it/s] 72%|███████▏  | 16675/23172 [00:05<00:01, 3901.65it/s] 75%|███████▌  | 17400/23172 [00:05<00:01, 3930.98it/s] 78%|███████▊  | 18125/23172 [00:06<00:03, 1667.71it/s] 81%|████████▏ | 18850/23172 [00:07<00:02, 1557.43it/s] 84%|████████▍ | 19575/23172 [00:07<00:01, 1865.19it/s] 88%|████████▊ | 20300/23172 [00:07<00:01, 2198.77it/s] 91%|█████████ | 21025/23172 [00:08<00:00, 2696.55it/s] 97%|█████████▋| 22475/23172 [00:08<00:00, 3748.84it/s]100%|██████████| 23172/23172 [00:08<00:00, 2817.31it/s]
10/04/2023 08:40:25 - INFO - util -   Read 1634 examples, avg src len: 224, avg trg len: 7, max src len: 3963, max trg len: 15
10/04/2023 08:40:25 - INFO - util -   [TOKENIZE] avg src len: 253, avg trg len: 14, max src len: 4520, max trg len: 46
10/04/2023 08:40:25 - INFO - util -   Create cache data into cache/codesum/java/train_src_all.pt
  0%|          | 0/1634 [00:00<?, ?it/s]  6%|▋         | 104/1634 [00:00<00:02, 628.86it/s] 13%|█▎        | 208/1634 [00:00<00:02, 643.67it/s] 19%|█▉        | 312/1634 [00:00<00:02, 637.12it/s] 25%|██▌       | 416/1634 [00:00<00:01, 638.73it/s] 32%|███▏      | 520/1634 [00:00<00:01, 635.65it/s] 38%|███▊      | 624/1634 [00:00<00:01, 634.65it/s] 45%|████▍     | 728/1634 [00:01<00:01, 633.02it/s] 51%|█████     | 832/1634 [00:01<00:01, 634.85it/s] 57%|█████▋    | 936/1634 [00:01<00:01, 625.70it/s] 64%|██████▎   | 1040/1634 [00:01<00:00, 624.10it/s] 70%|███████   | 1144/1634 [00:01<00:00, 626.12it/s] 76%|███████▋  | 1248/1634 [00:01<00:00, 628.91it/s] 83%|████████▎ | 1352/1634 [00:02<00:00, 630.45it/s] 89%|████████▉ | 1456/1634 [00:02<00:00, 630.89it/s] 95%|█████████▌| 1560/1634 [00:02<00:00, 630.36it/s]100%|██████████| 1634/1634 [00:02<00:00, 639.66it/s]
10/04/2023 08:40:28 - INFO - __main__ -     Num examples of Corpus = 23172
10/04/2023 08:42:24 - INFO - __main__ -     Num examples to retrieve = 1634
10/04/2023 08:42:37 - INFO - __main__ -   ranked list [22457 14459 21824 21985 15999 16217 22963 17018 20814 21607 15993 19804
 16451 22361 18062 21110 17376 19435 16272 21210 22249  1844 21978 20481
 20731 20946 10957 20045 16818 20172]
Total: 1634
10/04/2023 08:42:38 - INFO - __main__ -     codenn_bleu = 8.55 
10/04/2023 08:42:38 - INFO - __main__ -    save predict result in dataset/cpp/contextual_medits/codet5_retrieval_result/valid.jsonl.retireval.output
10/04/2023 08:42:38 - INFO - __main__ -   Finish and take 3m
saved dataset in dataset/cpp/contextual_medits/codet5_retrieval_result/valid.jsonl
